import{y as h,n as g,T as u,z as b,j as x,a as w,o as v,c as y,_ as l,E as k,g as d,G as z,s as C,l as _,H as B,J as $,K as M,N as S,O as I,P as A}from"./main.f1e40757.js";var T=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"font-default",attrs:{id:"concordanceApp"}},[t("div",{staticClass:"alertsContainer"},e._l(e.$store.state.alerts.alerts,function(i,p){return t("b-alert",{key:p,staticStyle:{display:"flex"},attrs:{variant:i.variant,show:i.countdown||!i.shouldCountdown,dismissible:!i.shouldCountdown,fade:""},on:{dismissed:function(r){return e.$store.commit({type:"alerts/setCountdown",alert:i,countdown:0})},"dismiss-count-down":function(r){return e.$store.commit({type:"alerts/setCountdown",alert:i,countdown:r})}}},[t("div",{staticStyle:{flex:"1"},domProps:{innerHTML:e._s(i.text)}}),i.buttonText?t("div",{staticClass:"fontWeight-heavy"},[t("a",{attrs:{href:""},domProps:{innerHTML:e._s(i.buttonText)},on:{click:function(r){return r.preventDefault(),i.buttonHandler(i,r)}}})]):e._e()])}),1),e.loadingGlobal||e.loading?t("loading-indicator-full"):e._e(),e.loaded?[t("the-navbar",{ref:"navbar",attrs:{title:"Concordances",reduced:!0}}),t("div",{staticClass:"main"},[t("div",{staticClass:"flexbox-row"},[t("div",{staticClass:"mappingTool order3",attrs:{id:"mappingTool"}},[t("div",{staticClass:"mappingToolItem mainComponent visualComponent",attrs:{id:"mappingBrowserComponent"}},[t("mapping-browser",{ref:"mappingBrowser",attrs:{"show-navigator":!1,"show-editing-tools":!1,"show-registry-override":["http://coli-conc.gbv.de/registry/coli-conc-mappings"],"show-cocoda-link":!0}})],1)])])])]:e._e()],2)},L=[];h.ElementQueries.listen();const P={name:"ConcordanceApp",components:{TheNavbar:u,MappingBrowser:b,LoadingIndicatorFull:x},mixins:[w,v,y],data(){return{loaded:!1,loading:!1,loadFromParametersOnce:l.once(this.loadFromParameters)}},computed:{locale(){return this.$i18n.locale},settingsLocale(){return"en"}},watch:{locale(e,o){e!=o&&(this.$store.commit({type:"settings/set",prop:"locale",value:e}),l.delay(()=>{this.insertPrefLabel(!0),this.insertPrefLabel(!1)},300))},settingsLocale(e){e!=this.locale&&(this.$i18n.locale=e)}},created(){this.load()},methods:{async load(){const e=new Date;this.loadingGlobal=!0,await this.$store.dispatch("loadConfig",l.get(this.$route,"query.config")),await this.$store.dispatch("settings/load"),document.title=this.config.title,this.$i18n.locale=this.settingsLocale,await k(),this.loaded=!0,this.loadingGlobal=!1,this.loadFromParametersOnce(!0);for(let o of this.config.registries)l.isArray(o.schemes)&&(o._jskos.schemes=o.schemes.map(t=>d(t)||t));this.$log.log(`Application loaded in ${(new Date-e)/1e3} seconds.`)},async loadFromParameters(e=!1){this.loading=!0;const o=this.$route.query,t={scheme:{true:o.fromScheme,false:o.toScheme},concept:{true:o.from,false:o.to}},i=async r=>{let n=t.scheme[r],a=null;n&&(a=d({uri:n}));let c=null;a&&t.concept[r]&&(c=C({uri:t.concept[r]},{scheme:a,type:"concept"}));try{await this.setSelected({concept:c,scheme:a,isLeft:r,noQueryRefresh:!0,noLoading:!0})}catch(s){this.$log.warn(s)}},p=async()=>{if(o.mapping||o.mappingUri||o.mappingIdentifier){let r=null;if(o.mapping)try{r=this.adjustMapping(this.$jskos.normalize(JSON.parse(o.mapping)))}catch(s){this.$log.warn("Error decoding mapping from URL parameter:",s)}l.isEqual(r,{})&&(r=null);let n=[];try{o.mappingUri?n.push(await this.getMapping({uri:o.mappingUri})):o.mappingIdentifier&&(n=await this.getMappings({identifier:o.mappingIdentifier}))}catch(s){this.$log.warn("Error loading mapping from URL parameter:",s)}n=n.filter(Boolean);let a=r,c=null;n.length&&(c=n.find(s=>l.get(s,"_registry").isAuthorizedFor&&l.get(s,"_registry").isAuthorizedFor({type:"mappings",action:"create",user:this.user}))||n[0],a=a||this.adjustMapping(this.$jskos.copyDeep(c))),this.$store.commit({type:"mapping/set",mapping:a,original:c,noQueryRefresh:!0}),_(this.$jskos.conceptsOfMapping(a)),a&&e&&(this.forceMappingBrowser=!0)}};if(await Promise.all([i(!0),i(!1),p()]),this.loading=!1,z(this.$store),e)if(o.search){let r=JSON.parse(o.search);this.forceMappingBrowser=!0,this.searchMappings(r)}else o.concordances!==void 0?this.showConcordances():(o.mappingUri||o.mappingIdentifier)&&(this.forceMappingBrowser=!0,this.searchMappings())},searchMappings(e){let o=this.$refs.mappingBrowser;o&&o.searchWithParams&&o.searchWithParams(e)},showMappingSearch(){this.forceMappingBrowser=!0,this.searchMappings({})},showConcordances(){let e=this.$refs.mappingBrowser;if(!e){this.$log.warn("Could not show concordances because MappingBrowser component was not found.");return}if(e.concordancesLoaded)e.tabIndexes.concordances!=null&&(this.forceMappingBrowser=!0,e.tab=e.tabIndexes.concordances);else{this.loadingGlobal=!0;let o;o=this.$watch(()=>e.concordancesLoaded,()=>{this.loadingGlobal=!1,e.tabIndexes.concordances!=null&&(this.forceMappingBrowser=!0,e.tab=e.tabIndexes.concordances),o&&o()})}}}},m={};var E=g(P,T,L,!1,F,null,null,null);function F(e){for(let o in m)this[o]=m[o]}var j=function(){return E.exports}();const f=B({store:M,router:S,i18n:I,render:()=>A(j)});$(f);f.mount("#concordanceApp");
